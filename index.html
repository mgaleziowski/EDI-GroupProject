<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width , initial-scale=1.0">
	<title>EDI Project</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    
   
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <div id="title">
        <h1>EDI Project</h1>
    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <h1>
                    Team Members
                </h1>
                <h2>
                    Mikołaj Gałęziowski
                </h2>
                <h2>
                    Wawrzyniec Ciuła
                </h2>
                <h2>
                    Łukasz Doniec
                </h2>
                <form>
                    <input id="przycisk" type="button" value="Refresh data" />
          
                </form>
                <div class="row">
                    <div id="chart_div"></div>
                </div>
                <div class="row">
                    <div id="chart_div2"></div>
                </div>
                <div class="row">
                    <div id="chart_div3"></div>
                </div>
            </div>
            <div class="col-sm-6">
                <div id="userTable"></div>
            </div>
        </div>
    </div>
    
   
   
</div>
</body>
    <script>   
   var male = 0;
    var female = 0;
    var nb = 0;
    var year21=0;
    var year22=0;
    var pl=0;
    var gr=0;
    var it=0;
    var sp=0;
    var uk=0;
    var fr=0;
    const pattern21=/.021/;
    const pattern22=/.022/;
   function showDataFromAPI(){
    male = 0;
    female = 0;
    nb = 0;
    year21=0;
    year22=0;
    pl=0;
    gr=0;
    it=0;
    sp=0;
    uk=0;
    fr=0;
    $.ajax({
    url: "https://my.api.mockaroo.com/edi.json?key=ee6a44c0&__method=POST",
    dataType: "json",
    success: function(data) {
        console.log(data);
        let output = "";
        output += `<table><tr>
            <th>ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Gender</th>
            <th>Address</th>
            <th>Country</th>
            <th>Shipment date</th>
         </tr>`;
        $(data).each(function(index) {
            if(data[index].gender=='Male'){
                male +=1;
            }
            if(data[index].gender!='Male' &&  data[index].gender!="Female"){
                nb +=1;
            }
            if(data[index].gender=='Female'){
                female +=1;
            }
            if(pattern21.test(data[index].date_of_shipment)==true){
                year21+=1;
            }
            if(pattern22.test(data[index].date_of_shipment)==true){
                year22+=1;
            }
            if(data[index].country=="Poland"){
                pl+=1;
            }
            if(data[index].country=="Germany"){
                gr+=1;
            }
            if(data[index].country=="France"){
                fr+=1;
            }
            if(data[index].country=="Ukraine"){
                uk+=1;
            }
            if(data[index].country=="Italy"){
                it+=1;
            }
            if(data[index].country=="Spain"){
                sp+=1;
            }
            output += `<tr>
                <td>${data[index].id}</td>
                <td>${data[index].first_name}</td>
                <td>${data[index].last_name}</td>
                <td>${data[index].email}</td>
                <td>${data[index].gender}</td>
                <td>${data[index].address}</td>
                <td>${data[index].country}</td>
                <td>${data[index].date_of_shipment}</td>

            </tr>`
        })
        output+=`</table>`;
        $('#userTable').html(output);
        drawChart(),
        drawChart2(),
        drawChart3()
    }
    
    });
    

}
showDataFromAPI();
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);
google.charts.setOnLoadCallback(drawChart2);
google.charts.setOnLoadCallback(drawChart3);

// Callback that creates and populates a data table,
// instantiates the pie chart, passes in the data and
// draws it.
function drawChart() {
    // Load the Visualization API and the corechart package.


// Set a callback to run when the Google Visualization API is loaded.

  // Create the data table.
  var data = new google.visualization.DataTable();
  data.addColumn('string', 'Gender of Customers');
  data.addColumn('number', 'number');
  data.addRows([
    ['Male', male],
    ['Female', female],
    ['Non-Binary', nb],
  ]);

  // Set chart options
  var options = {
    'title':'Gender of Customers',
    'width':400,
    'height':300,
    "backgroundColor": 'transparent' 
};
                 

  // Instantiate and draw our chart, passing in some options.
  var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
  chart.draw(data, options);
 
}
function drawChart2() {
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Shipments by Year');
    data.addColumn('number', 'number');
    data.addRows([
    ['2021', year21],
    ['2022', year22],
  ]);
    var options={
        "title":"Shipments by Year",
        "width":400,
        "height":300,
        "backgroundColor": 'transparent' 
    };
    var chart = new google.visualization.PieChart(document.getElementById('chart_div2'));
    chart.draw(data, options);
}
function drawChart3(){
    var data=new google.visualization.DataTable();
    data.addColumn('string','Shipments by Country');
    data.addColumn('number','number');
    data.addRows([
    ['Poland',pl],
    ['Germany',gr],
    ['Italy',it],
    ['Ukraine',uk],
    ['Spain',sp],
    ['France',fr]
    ]);
    var options={
        "title":"Shipments by Country",
        "width":400,
        "height":300,
        "backgroundColor": 'transparent'
    }
    var chart=new google.visualization.PieChart(document.getElementById("chart_div3"));
    chart.draw(data,options);
}
    </script>
    <script>
         var przycisk = document.getElementById('przycisk');
    przycisk.addEventListener("click", function() { showDataFromAPI(); });

   
    </script>
    

</html>